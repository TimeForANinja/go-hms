version: "{branch}-v1.0.0-{build}"

branches:
  only:
    - master

clone_folder: ~/go/src/github.com/timeforaninja/go-hms

image:
  - Ubuntu1804

stack: go 1.11

install:
  - sh: GOPATH=~/go
  - sh: rm -rf $GOPATH/src/github.com/timeforaninja/go-hms/.git
  - sh: echo "build-info:"
  - sh: echo $PATH
  - sh: echo $GOPATH
  - sh: echo $PWD
  - sh: ls -lahR $GOPATH/src/github.com/timeforaninja/go-hms
  # wait 3 seconds for the prev command
  - sh: sleep 3
  - go version
  - go env
  # libssl on linux & openssl on win already preinstalled
  - go get -u github.com/xeodou/go-sqlcipher
  - go get -u golang.org/x/crypto/bcrypt
  # basic golang validation
  - sh: echo "testing:"
  - go vet $GOPATH/src/github.com/timeforaninja/go-hms

build_script:
  - sudo $GOPATH/src/github.com/timeforaninja/go-hms/build.sh
  - sh: sudo bash $GOPATH/src/github.com/timeforaninja/go-hms/build.sh

artifacts:
  - path: artifacts
    name: hms-linux
  - path: artifacts
    name: hms-windows.exe
  - path: artifacts
    name: sql_schema.html
  - path: artifacts
    name: sql_schema.png
